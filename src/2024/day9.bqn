data â† â€¢file.Lines "../../samples/2024/day9.txt"
# data â†© â€¢file.Lines "../../samples/2024/day9_alt.txt"
data â†© â€¢file.Lines "../../inputs/2024/day9.txt"

# dyadic show but returns paired args
DShow â† {â€¢Show ğ•¨â€¿ğ•©â‹„ ğ•©}

Log â† {msgğ•Šval:
	â€¢Show (<msg)âˆ¾val
	val
}
RLog â† {msgğ•Šval:
	â€¢Show (msg)â‹ˆval
	val
}
TRLog â† {msgğ•Šval:
	â€¢Show (msg)â‹ˆ(30âŠ¸â†‘val)
	val
}

# returns 1 if the arg is a simple number/char
IsSimple â† {ğ•Šval:
	âŸ¨âŸ¨âŸ©,0âŸ©â‰¡(â‰¢â‹ˆâ‰¡)val
}

PartOne â† {ğ•Šlines:
	raw_data_config â† â†‘â€¿2â¥Š(â€¢ParseFloat â‹ˆ)Â¨ âŠ‘ lines
	data_config â† (â†•â‰ )âŠ¸(â¥ŠâŠ¸â‹ˆË˜)  raw_data_config
	# "data_config" RLog data_config â† (â†•â‰ )âŠ¸(â¥ŠâŠ¸â‹ˆË˜)  raw_data_config

	SwapBoth â†{strğ•Šlast_dig_idxâ€¿first_space_idx:
		swapped_str â† (last_dig_idxâŠ‘str)âŒ¾(first_space_idxâŠ¸âŠ‘) str
		 '.'âŒ¾(last_dig_idxâŠ¸âŠ‘) swapped_str
	}

	Render â† {âŸ¨idxâŸ©â€¿(sizeâ€¿space):
		chr â† @+(48 + idx)
		datum â† sizeâ¥Šchr
		padding â† spaceâ¥Š('.')
		datumâˆ¾padding
	}
  first_rendered â† âˆ¾ <âˆ˜RenderË˜ data_config
	# "first_rendered" RLog first_rendered


	# rendered â†© "123..."
	GetIndices â† ((Â¯1âŠ¸âŠ‘Â·/Â¬)â‹ˆ âŠ‘âˆ˜/)âˆ˜('.'âŠ¸=)

	Iter â† {ğ•Šrendered:
		last_dig_idxâ€¿first_space_idx â† GetIndices rendered
		next_rendered â† rendered SwapBoth last_dig_idxâ€¿first_space_idx
		# "new_rendered" RLog next_rendered
	}
	Cond â† {ğ•Šnext_rendered:
		last_dig_idxâ€¿first_space_idx â† GetIndices next_rendered
		greater_than â† last_dig_idx>first_space_idx
		# "greater than?" RLog greater_than
	}
	final_rendered â† Iter â€¢_while_ Cond first_rendered
	# "final_rendered" RLog final_rendered
	# parsed â† (â€¢ParseFloatâŠâ€¢Show)âˆ˜â‹ˆÂ¨ ('.'âŠ¸â‰ )âŠ¸/final_rendered
	parsed â† (-âŸœ(@+48)âˆ˜âŠ‘)âˆ˜â‹ˆÂ¨ ('.'âŠ¸â‰ )âŠ¸/final_rendered
	+Â´ Ã—Â´Ë˜ (â†•â‰ )âŠ¸(â‰Ë˜) parsed
}

PartTwo â† {ğ•Šlines:
	raw_data_config â† â†‘â€¿2â¥Š â€¢ParseFloatâˆ˜â‹ˆÂ¨ âŠ‘ lines
	data_config â† (â†•â‰ )âŠ¸(â¥ŠâŠ¸â‹ˆË˜)  raw_data_config
	# "data_config" RLog data_config â† (â†•â‰ )âŠ¸(â¥ŠâŠ¸â‹ˆË˜)  raw_data_config

	SwapBoth â†{strğ•Šorig_idxâ€¿dest_idx:
		swapped_str â† (orig_idxâŠ‘str)âŒ¾(dest_idxâŠ¸âŠ‘) str
		 '.'âŒ¾(orig_idxâŠ¸âŠ‘) swapped_str
	}

	Render â† {âŸ¨idxâŸ©â€¿(sizeâ€¿space):
		chr â† @+(48 + idx)
		datum â† sizeâ¥Šchr
		padding â† spaceâ¥Š('.')
		datumâˆ¾padding
	}
  first_rendered â† âˆ¾ <âˆ˜RenderË˜ data_config
	unique_chars â† '.'âŠ¸â‰ âŠ¸/â·first_rendered
	# "unique chars" RLog unique_chars


	# rendered â†© "123..."
	GetIndices â† ((Â¯1âŠ¸âŠ‘Â·/Â¬)â‹ˆ âŠ‘âˆ˜/)âˆ˜('.'âŠ¸=)
	GroupedCounts â† {charğ•Šy:
		foo â† â‰ âŸœÂ«y
		indices â† /1Â»foo
		counts â† (â‰ y)(Â«-âŠ¢) indices
		chars â† indicesâŠy
		(charâŠ¸=âˆ˜âŠ‘Â¨âŠ¸/) âˆ¾Â¨Â´ charsâ€¿countsâ€¿indices
	}

	FormatTime â† â¥Š 6â†‘ â€¢Fmt

	all_times â† âŸ¨âŸ©

	Iter â† {digğ•Šrendered:
		start â†	â€¢MonoTime @
		times â† âŸ¨âŸ©
		TD â† {msgğ•Šğ•©:
			time â† 1000Ã—(â€¢MonoTime @) - start
			prev â† (1âŠ¸âŠ‘ Â¯1âŠ¸âŠ‘)âŠtime times
			delta â† time - prev
			# msg RLog (FormatTime  time)â€¿(FormatTime delta)
			times âˆ¾âŸœ(<msgâ€¿timeâ€¿delta)â†©
		}
		!IsSimple dig
		"1st" TD @
		# "dig" Log dig
		# "rendered" RLog rendered
		all_spaces â†  > '.'GroupedCounts rendered
		"grp" TD @
		# "all_spaces (chr, num, idx)" RLog all_spaces
		# "target" Log target â† dig GroupedCounts rendered
		digits_idx â† / digâŠ¸=Â¨rendered
		# "digits_idx" RLog digits_idx
		# â€¢Show digits â† digâŠ¸=Â¨âŠ¸/rendered
		# "info " RLog info â†  (<â‰¢all_spaces)â€¿(<â‰ all_spaces)â€¿ (<â‰¡all_spaces)
		"dig" TD @
		CheckCount â† (â‰ digits_idx)âŠ¸â‰¤1âŠ¸âŠ‘
		CheckStart â† {ğ•Šchrâ€¿numâ€¿idx: idx < âŠ‘digits_idx}
		# pot_addrs â† (/(CheckCount)Ë˜)âŠ¸âŠ all_spaces
		pot_addrs â† (/ (CheckCount âˆ§ CheckStart)Ë˜)âŠ¸âŠ all_spaces
		# "pot_pos" RLog  pot_pos
		pot_idxs â† (< Â· â†•âŠ¸+Â´1âŠ¸â†“)Ë˜pot_addrs
		"2nd" TD @

		# â€¢Exit 0

		# â€¢Show pot_idxs
		new_rendered â† { 0â‰ â‰ pot_idxs
		?
			range â† (â‰ digits_idx)â†‘âŠ‘ pot_idxs
			# "range" RLog range
			pairs â† digits_idx â‹ˆÂ¨ range
			# "pairs" RLog pairs

			next_rendered â† rendered SwapBothËœÂ´ pairs
			# (digâˆ¾": new_rendered") TRLog next_rendered
			next_rendered

			"3 a" TD @
			next_rendered
		;
			# (digâˆ¾":     rendered") TRLog rendered
			"3 b" TD @
			rendered
		}


		all_times âˆ¾âŸœ(<times)â†©


		new_rendered
	}
	# final_rendered â† Iter â€¢_while_ Cond first_rendered

	# final_rendered â† (first_rendered Iter 0âŠ‘ unique_chars) Iter 1âŠ‘ unique_chars
	final_rendered â† (first_rendered IterÂ´ unique_chars)

	# â€¢Show {ğ•Šmsgâ€¿timeâ€¿diff: msgâ€¿(FormatTime diff)}Â¨ âˆ¾â¥Šall_times

	# parsed â† â€¢Show (-âŸœ(@+48))Â¨ â€¢Show ('.'âŠ¸â‰ )âŠ¸/final_rendered
	# parsed â† â€¢Show ((-âŸœ(@+48)â€¢Show)âŒ¾1âŠ¸âŠ‘)Â¨ â€¢Show ('.'âŠ¸â‰ 1âŠ¸âŠ‘Â¨)âŠ¸(/) (â†•â‰ )âŠ¸(â‹ˆÂ¨)final_rendered
	foo â† ('.'âŠ¸â‰ 1âŠ¸âŠ‘Â¨)âŠ¸(/) (â†•â‰ )âŠ¸(â‹ˆÂ¨)final_rendered
	parsed â† ((-âŸœ(@+48))âŒ¾(1âŠ¸âŠ‘) )Â¨ foo
	+Â´ Ã—Â´Â¨ parsed
}

SolutionValidator â† {partâ€¿expectedğ•Šanswer:
	err_msg â† ("Part "âˆ¾(â€¢Fmt part)âˆ¾" is wrong! Got instead: "âˆ¾(â€¢Fmt answer))
	err_msg!(expected= answer)
	â€¢Show "Correctly solved Part "âˆ¾(â€¢Fmt part)âˆ¾": "âˆ¾(â€¢Fmt answer)
}

AtLeastPartialSolutionValidator â† {partâ€¿expectedğ•Šanswer:
	err_msg â† ("Part "âˆ¾(â€¢Fmt part)âˆ¾" is too low! Got instead: "âˆ¾(â€¢Fmt answer))
	err_msg!(expectedâ‰¥ answer)
	â€¢Show "Correctly solved Part "âˆ¾(â€¢Fmt part)âˆ¾": "âˆ¾(â€¢Fmt answer)
}

AtMostPartialSolutionValidator â† {partâ€¿expectedğ•Šanswer:
	err_msg â† ("Part "âˆ¾(â€¢Fmt part)âˆ¾" is too high! Got instead: "âˆ¾(â€¢Fmt answer))
	err_msg!(expected< answer)
	â€¢Show "Correctly solved Part "âˆ¾(â€¢Fmt part)âˆ¾": "âˆ¾(â€¢Fmt answer)
}


# "part 1: " Log PartOne data
# "part 2: " Log PartTwo data

# sample
# 1â€¿1928 SolutionValidator PartOne data
# input
# 1â€¿6398252054886 SolutionValidator PartOne data

all_start â†	â€¢MonoTime @
# sample
# 2â€¿2858 SolutionValidator PartTwo data
# input
2â€¿6415666220005 SolutionValidator PartTwo data
all_end â†	â€¢MonoTime @

"total time" RLog all_end-all_start
