data â† â€¢file.Lines "../../samples/2024/day6.txt"
# data â†© â€¢file.Lines "../../samples/2024/day6_alt.txt"
data â†© â€¢file.Lines "../../inputs/2024/day6.txt"


Log â† {msgğ•Šval:
	â€¢Show (<msg)âˆ¾val
	val
}
RLog â† {msgğ•Šval:
	â€¢Show (msg)â‹ˆval
	val
}


chars â† "^>v<"
RotateGuard â† {ğ•Šchar:
	new_char â† ((â‰ chars)|1+Ëœ/charâ·chars)âŠchars
	âŠ‘new_char
}
Turn90 â† âŒ½Ë˜1âŠ¸â‰

IdxToRowCol â† {boardğ•Šidx:
	rowsâ€¿cols â† â‰¢ board
	row â† âŒŠ idxÃ·rows
	col â† rows|idx
	rowâ€¿col
}
# â€¢Show "IdxToRowCol"âŠ¸Log (>Ë˜ data) IdxToRowCol 24

PartOne â† {ğ•Šlines:

	char â† '>'
	# â€¢Show RotateGuard char

	# "lines"âŠ¸LogÂ¨ lines

	input â† 5â€¿5â¥Š @+97 + â†•26
	# â€¢Show Turn90â¼ Turn90âŸ1 input
	# â€¢Exit 0
	input â†© >Ë˜ lines
	input â†© (('.'âŠ¸=â—¶âŠ¢â€¿'â—‹')Â¨)âŒ¾â¥Š input
	# "orig input" Log input
	Joiner â† {yğ•Šline: ((â†•â‰ line)â‹ˆÂ¨Ëœy)â‹ˆÂ¨line}
	joinedâ† ((â†•â‰ ) JoinerË˜ âŠ¢)input
	rowsâ€¿cols â† â‰¢joined
	# "joined coords"âŠ¸Log 0âŠ‘Â¨ Turn90 joined
	# "joined char"âŠ¸Log 1âŠ‘Â¨ joined
	first_rowâ€¿first_col â† ((âŠ‘Â·/ â‰ Â¨)â‹ˆ(âŠ‘âˆ˜(â‰ Â¨âˆ¾âˆ˜/âŠ¢)))  <âˆ˜/Ë˜ {âŒˆÂ´âˆ¾Ë˜charsâŠ¸âˆŠâ‹ˆ 1âŠ‘ğ•©}Â¨ joined
	first_obj â† first_rowâ€¿first_col
	"first row,col" Log first_rowâ€¿first_col
	# â€¢Exit 0

	state â† âŸ¨âŸ©

	# in: (board, prev input) out: (rotated board, next input)
	Iter â† {ğ•Š(obj_rowâ€¿obj_col)â€¿prev_board:
		# â€¢Out (25/"-") âˆ¾ "Iter" âˆ¾ (25/"-")
		input â†© Turn90 prev_board

		obj â† obj_rowâ€¿obj_col
		# "obj"âŠ¸Log obj

		# "rotated (unchanged guard)"âŠ¸Log 1âŠ‘Â¨ input

		elm_idx â† âŠ‘(/(objâŠ¸â‰¡)âˆ˜âŠ‘Â¨) â¥Š input
		rowâ€¿col â† input IdxToRowCol elm_idx
		grabbed â† âˆ¾ rowâ€¿colâŠ‘input
		row_pairs â† rowâŠinput
		row_charsâ†1âŠ‘Â¨ row_pairs

		!'>'=char #sanity check
		char_idx â† col
		hash_idxs â†  >/'#'=row_chars

		next_hashes â† ((char_idxâŠ¸<)Â¨/âŠ¢) hash_idxs
		no_more_next â† 0=â‰ next_hashes

		{ no_more_next ?
			# â€¢Out "donezo"
			range â† (char_idx+â†• cols-char_idx)âŠrow_pairs
			new_state â† <âˆ˜âŠ‘Ë˜>range
			state â†© stateâˆ¾new_state
			@
		;
			# â€¢Out "THERE IS MORE"
			next_hash_idx â† âŠ‘next_hashes
			range â† (char_idx+â†• next_hash_idx-char_idx)âŠrow_pairs
			new_state â† <âˆ˜âŠ‘Ë˜>range

			next_obj â† âŠ‘ (rowâ€¿(1-Ëœnext_hash_idx))âŠ‘input
			# â€¢Show Turn90â¼ Turn90 1âŠ¸âŠ‘Â¨input
			state â†© stateâˆ¾new_state

			next_objâ€¿(Turn90âŸ2 input)
		}
	}


	Iterâ€¢_while_(@âŠ¸â‰¢) first_objâ€¿joined

	RiskyParse â† â€¢Bqn
	term_width â† RiskyParse 1âŠ‘ â€¢SH âŸ¨"tput", "cols"âŸ©
	â€¢Out term_width/"-"

	"state" Log â‰  â· âˆ§ state

}

PartTwo â† {ğ•Šlines:

	char â† '>'
	# â€¢Show RotateGuard char

	# "lines"âŠ¸LogÂ¨ lines

	input â† 5â€¿5â¥Š @+97 + â†•26
	# â€¢Show Turn90â¼ Turn90âŸ1 input
	# â€¢Exit 0
	input â†© >Ë˜ lines
	input â†© (('.'âŠ¸=â—¶âŠ¢â€¿'â—‹')Â¨)âŒ¾â¥Š input
	# "orig input" Log input
	Joiner â† {yğ•Šline: ((â†•â‰ line)â‹ˆÂ¨Ëœy)â‹ˆÂ¨line}
	input_with_objâ† ((â†•â‰ ) JoinerË˜ âŠ¢)input
	rowsâ€¿cols â† â‰¢input_with_obj
	# "joined coords"âŠ¸Log 0âŠ‘Â¨ Turn90 joined
	# "joined char"âŠ¸Log 1âŠ‘Â¨ joined
	first_rowâ€¿first_col â† ((âŠ‘Â·/ â‰ Â¨)â‹ˆ(âŠ‘âˆ˜(â‰ Â¨âˆ¾âˆ˜/âŠ¢)))  <âˆ˜/Ë˜ {âŒˆÂ´âˆ¾Ë˜charsâŠ¸âˆŠâ‹ˆ 1âŠ‘ğ•©}Â¨ input_with_obj
	first_obj â† first_rowâ€¿first_col
	"first row,col" Log first_rowâ€¿first_col
	# â€¢Exit 0

	# in: (board, prev input) out: (rotated board, next input)
	Iter â† {ğ•Š(obj_rowâ€¿obj_col)â€¿prev_board:
		degrees â† 90Ã—4|turns
		# â€¢Out (25/"-") âˆ¾ "Iter degrees: " âˆ¾ (â€¢Fmt degrees) âˆ¾ (25/"-")
		input â†© Turn90 prev_board

		obj â† obj_rowâ€¿obj_col
		# "obj"âŠ¸Log obj

		# "rotated (unchanged guard)"âŠ¸Log 1âŠ‘Â¨ input

		elm_idx â† âŠ‘(/(objâŠ¸â‰¡)âˆ˜âŠ‘Â¨) â¥Š input
		rowâ€¿col â† input IdxToRowCol elm_idx
		grabbed â† âˆ¾ rowâ€¿colâŠ‘input
		row_pairs â† rowâŠinput
		row_charsâ†1âŠ‘Â¨ row_pairs

		!'>'=char #sanity check
		char_idx â† col
		hash_idxs â†  >/'#'=row_chars

		next_hashes â† ((char_idxâŠ¸<)Â¨/âŠ¢) hash_idxs
		no_more_next â† 0=â‰ next_hashes

		res â† { no_more_next ?
			# â€¢Out "donezo"
			range â† (char_idx+â†• cols-char_idx)âŠrow_pairs
			new_steps â† <âˆ˜(degreesâŠ¸â‹ˆ)âˆ˜âŠ‘Ë˜>range
			overlapping_steps â† new_stepsâˆŠsteps
			any_overlap â† âŒˆÂ´ overlapping_steps

			{ any_overlap ?
				# â€¢Out "looping on last"
				"loop"
			;
				steps â†© stepsâˆ¾new_steps
				@
			}
		;
			next_hash_idx â† âŠ‘next_hashes
			range â† (char_idx+â†• next_hash_idx-char_idx)âŠrow_pairs
			new_steps â† <âˆ˜(degreesâŠ¸â‹ˆ)âˆ˜âŠ‘Ë˜>range

			overlapping_steps â† new_stepsâˆŠsteps
			any_overlap â† âŒˆÂ´ overlapping_steps

			{ any_overlap ?
				# â€¢Out "looping in first"
				"loop"
			;

				next_obj â† âŠ‘ (rowâ€¿(1-Ëœnext_hash_idx))âŠ‘input
				# â€¢Show Turn90â¼ Turn90 1âŠ¸âŠ‘Â¨input
				steps â†© stepsâˆ¾new_steps

				next_objâ€¿(Turn90âŸ2 input)
			}
		}

		turns 1âŠ¸+â†©
		res
	}




	RiskyParse â† â€¢Bqn
	term_width â† RiskyParse 1âŠ‘ â€¢SH âŸ¨"tput", "cols"âŸ©
	â€¢Out term_width/"-"

	steps â† âŸ¨âŸ©
	turns â† 0
	Iterâ€¢_while_(@âŠ¸â‰¢) first_objâ€¿input_with_obj

	"orig_steps"âŠ¸Log orig_steps â† steps
	"num orig_steps" Log â‰ orig_steps
	# "turns" Log turns

	all_to_remove â† â€¢Show â· 1âŠ¸âŠ‘Â¨ orig_steps
	â€¢Out term_width/"!"

	tries â† 0

	TryWithObstacle â† {ğ•Što_remove:
		tries 1âŠ¸+â†©
		"tries" Log tries
		# add obstacle to input for this iteration
		input â† (to_removeâŠ¸â‰¡âˆ˜âŠ‘)â—¶âŠ¢â€¿('#'âŒ¾(1âŠ¸âŠ‘))Â¨ âŒ¾â¥Š  input_with_obj
		# "input" RLog 1âŠ¸âŠ‘Â¨input

		steps â†© âŸ¨âŸ©
		turns â†© 0
		# "first_obj" Log  first_obj
		Iterâ€¢_while_{
			is_done â† (@âŠ¸â‰¡)ğ•©
			is_looping â† ("loop"âŠ¸â‰¡)ğ•©

			# "is_done" Log is_done
			is_looping
			 continue â† (0=is_done) âŒŠ (0=is_looping)

			 continue
			 continue

			} first_objâ€¿input

	}
		to_remove â† âŠ‘all_to_remove
		# TryWithObstacle to_remove

	results â† TryWithObstacleÂ¨ all_to_remove
	loops â† ("loop"âŠ¸â‰¡)Â¨ results
	"len loops" Log +Â´ loops



}

SolutionValidator â† {partâ€¿expectedğ•Šanswer:
	err_msg â† ("Part "âˆ¾(â€¢Fmt part)âˆ¾" is wrong! Got instead: "âˆ¾(â€¢Fmt answer))
	err_msg!(expected= answer)
	â€¢Show "Correctly solved Part "âˆ¾(â€¢Fmt part)âˆ¾": "âˆ¾(â€¢Fmt answer)
}

PartialSolutionValidator â† {partâ€¿expectedğ•Šanswer:
	err_msg â† ("Part "âˆ¾(â€¢Fmt part)âˆ¾" is too low! Got instead: "âˆ¾(â€¢Fmt answer))
	â€¢Show expectedâ€¿answer
	"expected is < answer" Log expected<answer
	err_msg!(expected< answer)
	â€¢Show "Correctly solved Part "âˆ¾(â€¢Fmt part)âˆ¾": "âˆ¾(â€¢Fmt answer)
}

foo â† âŸ¨@, @, "loop", @âŸ©
"foo" Log foo

â€¢Show +Â´ ("loop"âŠ¸â‰¡ â€¢Show)Â¨foo


# "part 1: " Log PartOne data
# "part 2: " Log PartTwo data
# 1â€¿4752 SolutionValidator PartOne data
# 2â€¿6 SolutionValidator PartTwo data
2â€¿1720 PartialSolutionValidator PartTwo data
