data â† â€¢file.Lines "../../samples/2024/day3.txt"
data â†© â€¢file.Lines "../../samples/2024/day3_alt.txt"
data â†© â€¢file.Lines "../../inputs/2024/day3.txt"


Log â† {msgğ•Šval:
	â€¢Show msgâ€¿val
	val
}

verbose â† 0
CLog â† {msgğ•Šval:
	{verbose ? â€¢Show msgâ€¿val ; @}
	val
}

mul    â† "mul("     # 1
digits â† @+48 + â†•10 # 2
com    â† ','        # 3
end    â† ')'        # 4

allowed_chars â† mulâˆ¾",)"âˆ¾digits

Find â† {charsğ•Šinput:
	charsâ·input âˆ¾ (0Ë˜ (â†• -âŸœ1âˆ˜â‰ )chars)
}

MakeValid â† (âŠ‘âˆ˜(mulâŠ¸â·)Â¨/âŠ¢) (4âŠ¸â‰¤âˆ˜â‰ Â¨/âŠ¢)

PartOne â† {ğ•Šlines:
		PerLine â† {ğ•Šline:
			"line" Log line
			mul_part â† MakeValid  (mulâŠ¸Find +`âŠ¸âŠ”âŠ¢)line

			"mul_part"âŠ¸LogÂ¨ mul_part
			â€¢Out 50/"-"

			end_idxs â† (/ ")"âŠ¸Find)Â¨ mul_part
			"end_idxs"âŠ¸LogÂ¨ end_idxs
			â€¢Out 50/"-"

			raw_parts â† ((0â‰ â‰ Â¨) end_idxs )/ mul_part
			"raw_parts"âŠ¸LogÂ¨ raw_parts
			â€¢Out 50/"-"
			ranges_until_empty  â† ((0â‰ â‰ Â¨) âŠ‘Â¨âˆ˜/ âŠ¢) end_idxs # ends without empties

			 # "end_idxs" Log end_idxs
			 # "raw_parts" Log raw_parts
			 "ranges_until_empty" Log ranges_until_empty
			raw_grabbed â† ranges_until_empty (4â†“â†‘)Â¨ raw_parts
			"raw_grabbed" Log raw_grabbed
			grabbed â†  ((âŒŠÂ´ allowed_charsâŠ¸(âˆŠËœ) )Â¨/âŠ¢) raw_grabbed
			"grabbed" Log grabbed
			splitcomma â† ','(((âŠ¢-Ëœ+`Ã—Â¬)âˆ˜=)âŠ”âŠ¢)Â¨ grabbed
			"splitted" Log splitcomma
			parsed â† â€¢ParseFloatÂ¨Â¨ splitcomma
			"parsed" Log parsed

			Range â† 1âŠ¸â‰¤ âˆ§ 1000âŠ¸>
			valids_mask â† (âŒŠÂ´ RangeÂ¨)Â¨ parsed
			valids â† valids_mask/parsed
			"valids" Log valids
			mul_res â† Ã—Â´Â¨ valids
			res â† +Â´ mul_res

			res
		}

		+Â´ ( PerLine)Â¨ lines
}

PartTwo â† {ğ•Šlines:

	do â† "do()"
	dont â† "don't()"


	PerLine â† {ğ•Šline:
		dosâ† / do â· line
		dontsâ† / dont â· line
		"line" Log line

		mul_part â† MakeValid  (mulâŠ¸Find +`âŠ¸âŠ”âŠ¢)line
		cmd_idx â† âˆ¾Â´ lineâŠ¸(/âˆ˜â·Ëœ)Â¨ mul_part
		"cmd_idx"âŠ¸LogÂ¨ cmd_idx
		joined â† mul_part âˆ¾Ë˜Ëœ cmd_idx
		â€¢Show joined

		BuildEnableMask â† {doingğ•Šidx:
			 # idk why âŠ‘ is needed, since idx is a unit
			 in_dos â† âŠ‘ idxâˆŠdos
			 in_donts â† âŠ‘ idxâˆŠdonts

			 { in_dos ? 1 ; in_donts ? 0 ; doing}
		}

		enabled_mask_idx â†  / 1(BuildEnableMask)` â†• â‰ line
		"enabled_mask_idx" Log enabled_mask_idx

		cmds â†  âˆ¾Â´ (/ â·âŸœline)Â¨ mul_part
		"cmds" Log cmds
		enabled_cmds â† (cmdsâˆŠenabled_mask_idx)/âŠ¢ cmds

		end_mask â† (/ ")"âŠ¸Find)Â¨ MakeValid mul_part
		valid_ends_mul_parts â† ((0âŠ¸â‰ âˆ˜â‰ Â¨ end_mask )/ mul_part)
		"tran"Log âŠâŒ½â‰joined
		"pick" Log 1âŠ¸âŠË˜ joined
		valid_joined â†         (/âŠâŒ½â‰joined       âˆŠ valid_ends_mul_parts) âŠjoined
		enabled_valid_joined â† (/âŠâ‰ valid_joined âˆŠ enabled_cmds)         âŠvalid_joined
		to_parse â† 1âŠË˜ enabled_valid_joined
		"to_parse" Log to_parse

		ranges â†  âŠ‘Â¨ (/ ")"âŠ¸Find)Â¨  to_parse
		"ranges" Log ranges
		grabbed â†  ((âŒŠÂ´ allowed_charsâŠ¸(âˆŠËœ) )Â¨/âŠ¢) ranges((â‰ mul)âŠ¸â†“âˆ˜â†‘Â¨)to_parse

		splitcomma â† ','(((âŠ¢-Ëœ+`Ã—Â¬)=)âŠ”âŠ¢)Â¨ grabbed
		parsed â† â€¢ParseFloatÂ¨Â¨ splitcomma

		Range â† (1âŠ¸â‰¤âˆ§1000âŠ¸>)
		valids_mask â† âŒŠÂ´âˆ˜(RangeÂ¨)Â¨ parsed
		valids â† valids_mask/ parsed
		mul_res â† Ã—Â´Â¨ valids
		res â† +Â´ mul_res

		res
	}

	PerLine âˆ¾ lines
}



# "Part 1 is wrong!"!161= "part 1: " Log PartOne data
# "Part 2 is wrong!"!48= "part 2: " Log PartTwo data
"Part 1 is wrong!"!165225049= "part 1: " Log PartOne data
"Part 2 is wrong!"!108830766= "part 2: " Log PartTwo data
