data â† â€¢file.Lines "../../samples/2024/day3.txt"
data â†© â€¢file.Lines "../../samples/2024/day3_alt.txt"
# data â†© â€¢file.Lines "../../inputs/2024/day3.txt"


Log â† {msgğ•Šval:
	â€¢Show msgâ€¿val
	val
}

verbose â† 0
CLog â† {msgğ•Šval:
	{verbose ? â€¢Show msgâ€¿val ; @}
	val
}


mul â† "mul(" #1
digits â† @+48 + â†•10 #2
com â† ',' #3
end â† ')' #4

allowed_chars â† mulâˆ¾",)"âˆ¾digits

# â€¢Show [1,2,3,2,4]
# â€¢Show [1,2,2, 2,3,2,2,2,4]


Find â† {charsğ•Šinput:
	charsâ·input âˆ¾ (0Ë˜ (â†• -âŸœ1âˆ˜â‰ )chars)

}

PartOne â† {ğ•Šlines:
		PerLine â† {ğ•Šline:
			paddings â† ( (+âŸœ(â†•4))Ë˜ / mul Find line)
			mul_mask â† âŒˆË { "mul(" Find line}Ë˜ paddings
			MakeValid â† ((âŠ‘âˆ˜(mulâŠ¸â·)âˆ˜â€¢ShowÂ¨)/âŠ¢) ((4âŠ¸â‰¤âˆ˜â‰ Â¨)/âŠ¢)
			mul_part â† MakeValid  mul_mask+`âŠ¸âŠ”line

			end_mask â† (/ ")"âŠ¸Find)Â¨ MakeValid mul_mask+`âŠ¸âŠ”line
			e_w_e â† (((0â‰ â‰ Â¨)âŠ‘Â¨âˆ˜/âŠ¢) end_mask) #ends without empties
			lengths â† (((0â‰ â‰ Â¨) end_mask )/ mul_part)
			grabbed â†  ((âŒŠÂ´ allowed_charsâŠ¸(âˆŠËœ) )Â¨/âŠ¢) (e_w_e 4âŠ¸â†“âˆ˜â†‘Â¨ lengths)
			splitcomma â† ','(((âŠ¢-Ëœ+`Ã—Â¬)âˆ˜=)âŠ”âŠ¢)Â¨ grabbed
			parsed â† (â€¢ParseFloatÂ¨ )Â¨ splitcomma

			Range â† (1âŠ¸â‰¤âˆ§1000âŠ¸>)
			valids_mask â† (âŒŠÂ´ RangeÂ¨)Â¨ parsed
			valids â† valids_mask/ parsed
			mul_res â† Ã—Â´Â¨ valids
			res â† +Â´ mul_res

			res
		}

		+Â´ ( PerLine)Â¨ lines
}

PartTwo â† {ğ•Šlines:

	do â† "do()"
	dont â† "don't"
	â€¢Show line â† âŠ‘data


	PerLine â† {ğ•Šline:
		"FIND DO" Log dosâ† / do â· line
		"FINDâ‰ DO" Log dontsâ† / dont â· line

		paddings â† ( (+âŸœ(â†•4))Ë˜ / mul Find line)
		mul_mask â† âŒˆË { "mul(" Find line}Ë˜ paddings
		MakeValid â† ((âŠ‘âˆ˜(mulâŠ¸â·)Â¨)/âŠ¢) ((4âŠ¸â‰¤âˆ˜â‰ Â¨)/âŠ¢)
		mul_part â† MakeValid  mul_mask+`âŠ¸âŠ”line
		cmd_idx â† âˆ¾Â´ lineâŠ¸(/âˆ˜â·Ëœ)Â¨ mul_part
		# "mul_part"âŠ¸LogÂ¨ mul_part
		# "cmd_idx" Log cmd_idx
		"joined" Log joined â† mul_part âˆ¾Ë˜Ëœ cmd_idx

		BuildEnableMask â† {doingğ•Šidx:
			 # idk why âŠ‘ is needed, since idx is a unit
			 in_dos â† âŠ‘ idxâˆŠdos
			 in_donts â† âŠ‘ idxâˆŠdonts

			 { in_dos ? 1 ; in_donts ? 0 ; doing}
		}

		# â€¢Show â†• âŒˆÂ´ dos2âˆ¾donts2,
		enabled_mask_idx â†  / 1(BuildEnableMask)` â†• â‰ line


		"cmds" Log cmds â†  âˆ¾Â´ (/ â·âŸœline)Â¨ mul_part
		"enabled_cmds" Log enabled_cmds â† (cmdsâˆŠenabled_mask_idx)/âŠ¢ cmds
		# "enabled_mask" Log enabled_mask â† (âˆŠâŸœenabled_cmds) cmd_idx

		end_mask â† (/ ")"âŠ¸Find)Â¨ MakeValid mul_part
		# "end_mask" Log end_mask
		valid_ends_mul_parts â† (((0â‰ â‰ Â¨) end_mask )/ mul_part)
		"valid_ends_mul_parts" Log valid_ends_mul_parts
		"valid_joined" Log  valid_joined â† (/ ((âŠâŒ½â‰joined) âˆŠ valid_ends_mul_parts))âŠjoined
		# filter out the valid_joined
		"rotated" Log rotated â† (/((âŠâ‰valid_joined) âˆŠ enabled_cmds))âŠvalid_joined

		â€¢Exit 1


		lengths â† (((0â‰ â‰ Â¨)âŠ‘Â¨âˆ˜/âŠ¢) end_mask) #ends without empties
		# "ewe" Log lengths
		"grabbed" Log grabbed â†  ((âŒŠÂ´ allowed_charsâŠ¸(âˆŠËœ) )Â¨/âŠ¢) (lengths (â‰ mul)âŠ¸â†“âˆ˜â†‘Â¨ valid_ends_mul_parts)
		splitcomma â† ','(((âŠ¢-Ëœ+`Ã—Â¬)âˆ˜=)âŠ”âŠ¢)Â¨ grabbed
		parsed â† (â€¢ParseFloatÂ¨ )Â¨ splitcomma

		Range â† (1âŠ¸â‰¤âˆ§1000âŠ¸>)
		valids_mask â† (âŒŠÂ´ RangeÂ¨)Â¨ parsed
		valids â† valids_mask/ parsed
		"valids" Log valids
		mul_res â† Ã—Â´Â¨ valids
		res â† +Â´ mul_res

		res
	}

	+Â´ ( PerLine)Â¨ lines
}

# "part 1: " Log PartOne data
"part 2: " Log PartTwo data

# "Part 1 is wrong!"!472= "part 1: " Log PartOne data
# "Part 2 is wrong!"!520= "part 2: " Log PartTwo data
