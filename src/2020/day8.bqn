data â† â€¢file.Lines "../../samples/2020/day8.txt"
# data â†© â€¢file.Lines "../../samples/2020/day8_alt.txt"
data â†© â€¢file.Lines "../../inputs/2020/day8.txt"

Log â† {
	msgâ€¿val â† ğ•©
	â€¢Show msgâ€¿val
	val
}


SplitBy â† (+`âˆ˜=âŠ”âŠ¢)

limit â† 1_000

PartOne â† {
	ParseOne â† {
		"nop"â€¿val: 1â€¿0;
		"acc"â€¿val: 1â€¿val;
		"jmp"â€¿val: valâ€¿0
	}

	acc â† 0
	idx â† 0
	all_idxs â† âŸ¨âŸ©
	insts â† {â€¢ParseFloatâŒ¾(1âŠ¸âŠ‘) (('+'âŠ¸â‰ /âŠ¢)' 'âŠ¸â‰ /âŠ¢)Â¨ ' 'SplitBy ğ•©}Â¨ ğ•©
	âˆ˜â€¿1â¥Š insts

	iterations â† 0

	{ ğ•©
		inst â† idxâŠ‘ insts
		offsetâ€¿to_add â† ParseOne inst
		# â€¢Show "acc"â€¿acc
		# Log "offset, to add"â€¿(offsetâ€¿(to_add))
		(offsetâ€¿(to_add))
	}â€¢_while_{ğ•Šoffsetâ€¿to_add:

		iterations â†© iterations+1

		new_idx â† idx+offset

		# â€¢Delay 0.25


		already_processed â† 1= ( +Â´ â¥Š new_idxâˆŠall_idxs)
		{ ((iterations> limit) âˆ¨ already_processed) ?
			0 ;

			idx â†© new_idx
			acc â†© acc+to_add
			all_idxs â†© all_idxsâˆ¾ idx
			1
		}
	} ParseOne âŠ‘ insts
	acc
}

ParseTwo â† {
	swapğ•Š"nop"â€¿val: {Â¬swap ? 1â€¿0 ; valâ€¿0};
	swapğ•Š"acc"â€¿val: 1â€¿val;
	swapğ•Š"jmp"â€¿val: {Â¬swap ? valâ€¿0 ; 1â€¿0}
}


# SafeTake â† {countğ•Šarr: (countâŒŠâ‰ arr)â†‘arr}
SafeTake â† (âŒŠâŸœâ‰ â†‘âŠ¢)
# â€¢Show 20(âŒŠâŸœâ‰ â†‘)â†•10

PartTwo â† {

	raw_insts â† {â€¢ParseFloatâŒ¾(1âŠ¸âŠ‘) (('+'âŠ¸â‰ /âŠ¢)' 'âŠ¸â‰ /âŠ¢)Â¨ ' 'SplitBy ğ•©}Â¨ ğ•©

	# â€¢Show (0 âŠ¸ParseTwo )Â¨10 SafeTake raw_insts 
	Iter â† {ğ•Što_swap_idx:
		acc â† 0
		idx â† 0
		seen_idxs â† âŸ¨âŸ©

		insts â† {iâ€¿pair:
			(i=to_swap_idx)ParseTwo pair
		}Â¨ (â†•âˆ˜â‰ â‹ˆÂ¨âŠ¢)raw_insts

		# â€¢Show âˆ˜â€¿1â¥Š insts

		iterations â† 0

		Loop â† {
			ğ•©
			idxâŠ‘ insts
		}

		Cond â† {ğ•Šoffsetâ€¿to_add:

			iterations â†© iterations+1

			new_idx â† idx+offset

			already_processed â† 1= ( +Â´ â¥Š new_idxâˆŠseen_idxs)
			within_limit â† iterations > limit
			{ (new_idx = â‰ insts) âˆ¨ within_limit âˆ¨ already_processed ?
				# â€¢Show "done"â€¿idx
				idx â†© new_idx
				acc â†© acc+to_add
				seen_idxs â†© seen_idxsâˆ¾ idx
				0 ;

				# â€¢Show "iter"â€¿idxâ€¿accâ€¿offsetâ€¿to_add
				idx â†© new_idx
				acc â†© acc+to_add
				seen_idxs â†© seen_idxsâˆ¾ idx
				1
			}
		}
		Loop â€¢_while_ Cond   âŠ‘ insts
		[âŸ¨"idx","acc", "iterations"âŸ©
		  âŸ¨idx,  acc,   iterations âŸ©]
	}

	to_swap_idxs â†  /(<"acc")â‰¢Ë˜ >âŠÂ¨ raw_insts
	{ğ•Što_swap_idx:
		resâ†Iter to_swap_idx
		# â€¢Show "res"â€¿res
		res
	}Â¨ to_swap_idxs
}


# â€¢Show "part1"â€¿(PartOne data)
â€¢Show âŠ‘ ({+Â´(â‰ data)=1âŠğ•©}Â¨/âŠ¢) (PartTwo data)

â€¢Show "done"
