data â† â€¢file.Lines "../../samples/2020/day7.txt"
# data â†© â€¢file.Lines "../../inputs/2020/day7.txt"

SplitBy â† (+`âˆ˜=âŠ”âŠ¢)

# from bqncrate
FindInString â† {âˆŠâŸœğ•©âŒ¾<ğ•¨}

# remove substring from string
StripSubstring â† {
	full_find â† ğ•¨(â‰¢âˆ˜âŠ¢â†‘â·)ğ•©
	sub_range â† â†•â‰ ğ•¨
	full_range â† â†•â‰ ğ•©

	# characters not in the substring
	mask â† full_range Â¬âˆ˜âˆŠâ¥Š (sub_rangeâŠ¸+)Ë˜ full_find/full_range
	mask/ğ•©
}

# find which character is a digit character
IsNonNumericChar â† {
	nums â† '0'+â†•10
	res â† >Â¬âŒˆË nums= ğ•©
}
# â€¢Show IsNonNumericChar <"99i 2 am 55 years old"

MarkAllowed â† {
	full_find â† ğ•¨(â‰¢âˆ˜âŠ¢â†‘â·)ğ•©
	sub_range â† â†•â‰ ğ•¨
	full_range â† â†•â‰ ğ•©

	# characters not in the substring
	mask â† full_range Â¬âˆ˜âˆŠâ¥Š (sub_rangeâŠ¸+)Ë˜ full_find/full_range
}


ParseAllNumbers â† {
	# 1s where a digit is found
	mask â† (Â¬IsNonNumericChar < ğ•©)
	# start index and end index of each number within the string
	bounds â† âˆ˜â€¿2â¥Š/0 (âˆ¾â‰ âˆ¾Ëœ) mask
	# the start index plus its offset
	join â† (âŠâˆ¾-ËœÂ´)Ë˜bounds
	# each index in the string a digit is at
	idxs â† (<â†•âˆ˜(1âŠ¸âŠ‘)+Ë˜âŠ‘)Ë˜join
	# pull out each char at each index, and parse the whole number
	parsed â†(â€¢ParseFloat âŠâŸœğ•© )Â¨idxs
	parsed
}

ParseBagNew â† {
	# mostly from bqnrate, splits on mask ğ•¨
	Qwe â† +`(Ã—âŠâ€¢Show)Â¬
	Split â† ((0âŠ¸â‰ âˆ˜â‰ Â¨)/âŠ¢)((âŠ¢-ËœQwe)âŠ¸âŠ”)

	# run many precleaners on the input
	preclean â† ğ•© StripSubstringÂ´ âŸ¨".", " bag", " bags"âŸ©

	mask â† Â¬" contain " MarkAllowed preclean
	containerâ€¿raw_childrenâ† (mask) Split preclean

	comma_mask â† Â¬ "," MarkAllowed raw_children
	# â€¢Show comma_mask

	DropLeadingSpace â† ((' '=âŠ)â†“âŠ¢)
	JoinFunc â† ParseAllNumbersâˆ¾(<âˆ˜DropLeadingSpace IsNonNumericCharâˆ˜</âŠ¢)
	children â† (JoinFunc DropLeadingSpace)Â¨ comma_mask Split raw_children
	containerâ€¿children
}


# which bags can eventually contain a shiny gold bag?
BreakIntoParentChildPairs â† {
	bags â† ParseBagNewÂ¨ ğ•©

	ConcatChildren â† {
		containerâ€¿children â† ğ•©
		((<container)âŠ¸âˆ¾âˆ˜<)Â¨ children

	}
	parent_child_pairs â† âˆ¾â¥ŠË˜ (>ConcatChildren)Â¨ bags
	parent_child_pairs
}

Sep â† {
	num â† 10
	# â€¢Out  âˆ¾Â´ â¥Š âˆ¾Â´ ((num/"-")â€¿(ğ•©)â€¿(num/"-"))
	ğ•©
	â€¢Out  âˆ¾Â´ â¥Š âˆ¾Â´ ((num/"-")â€¿(â€¢Repr ğ•©)â€¿(num/"-"))
}

PartOne â† {
	parent_child_pairs â† BreakIntoParentChildPairs ğ•©
	# â€¢Show parent_child_pairs


	all_found_bags â† âŸ¨âŸ©

	containing_target â† âŸ¨âŸ©

	FindBags â† {

		target â† ğ•©
		# â€¢Show 50/"-"
		# â€¢Show "target"â€¿target

		bags_containing_target_mask â† (targetâŠ¸âˆŠ1âŠ¸âŠ‘)Ë˜ parent_child_pairs
		# â€¢Show â‰¢ bags_containing_target_mask

		containing_target â†© âŠË˜ bags_containing_target_mask/parent_child_pairs
		# â€¢Show "containing_target"â€¿containing_target

		found_new_containers â† (0â‰ â‰  containing_target)
		{ found_new_containers ?
			{ all_found_bags â†© â·all_found_bags âˆ¾ containing_target}
			; 0
		}
		containing_target
	}
	new_bags â† âŸ¨"shiny gold", "shiny gold"âŸ©
	# new_bags â†© FindBagsË˜ new_bags
	# new_bags â†© â· â¥Š FindBagsË˜ new_bags
	# new_bags â†© â· â¥Š FindBagsË˜ new_bags

	Massage â† {
		found â†  FindBags ğ•©
		# â€¢Show "massaged"â€¿(â‰ found)â€¿found
		found
	}

	Body â† {
		# â€¢Show "to finds"â€¿ğ•©
		raw_new_bags â† ((<âˆ˜Massage)Ë˜) ğ•©

		# â€¢ShowÂ¨ raw_new_bags
		new_bags â†© â·âˆ˜({ "shape"â€¿(â‰¢ğ•©)}âŠ¢âŠ¢) (âˆ¾â¥Š) raw_new_bags

		# â€¢Show "new_bags"â€¿(â‰¢new_bags)â€¿(new_bags)
		new_bags
	}

	Condition â† {
		ğ•©
		# â€¢Show "loop check"
		res â† 0â‰ â‰  new_bags
		res
	}
	Body â€¢_while_ Condition new_bags

	all_found_bags
	â€¢Show â‰ all_found_bags

}

PartTwo â† {
	parent_child_pairs â† BreakIntoParentChildPairs ğ•©

	# normalize the no other bags to 0 value
	NormalizeNoOther â† {
		bag_nameâ€¿Â· â† ğ•©
		((â‹ˆ"no other")â‰¡(1âŠ‘ğ•©))
		? âŸ¨bag_name, 0â‹ˆ"no other"âŸ©
		; ğ•©
	}
	parent_child_pairs â†© NormalizeNoOtherË˜ parent_child_pairs
	# â€¢Show parent_child_pairs


	total_contained â† 0


	PerPair â† {
		value â† ğ•¨
		CalcValue â† {
			# scale the number of bags by the value
			ScaleValue â† {
				res â† valueÃ— 1+ 0âŠ‘ > 1âŠğ•©
				res
			}

			(âŠâˆ¾ScaleValue )ğ•©
		}
		CalcValue ğ•©
	}

	ScaleTargetByValue â† {
		value â† ğ•¨
		target â† ğ•©
		â€¢Show "target:"â€¿target

		mask â† {targetâ‰¡ 1âŠ‘1âŠ‘ğ•©}Ë˜ parent_child_pairs
		found_targets â† (mask/parent_child_pairs)
		# â€¢Show "found_targets"â€¿found_targets
		res â† value PerPair Ë˜ found_targets
		â€¢Show "res"â€¿res
		# â€¢Show âŸ¨"shape"â€¿(â‰¢res), "depth"â€¿(â‰¡res), "len"â€¿(â‰ res), "rank"â€¿(=res)âŸ©

		res
	}

	StripEmpty â† ((0â‰ â‰ Â¨)/âŠ¢)

	targets_and_values â† â€¢Show âŸ¨âŸ¨"no other", 2âŸ©âŸ©
	â€¢Show "targets"â€¿targets_and_values

	new_targets_and_values â†  âˆ˜â€¿2â¥Š(1âŠ¸âŠ‘ ScaleTargetByValue âŠ‘)âˆ˜>Ë˜  targets_and_values
	# â€¢Show "new1"â€¿(new_targets_and_values)
	â€¢Show 50/"-"

	new_targets_and_values â†© âˆ¾ StripEmpty <âˆ˜(1âŠ¸âŠ‘ ScaleTargetByValue âŠ‘)Ë˜  new_targets_and_values
	# â€¢Show "new2"â€¿(new_targets_and_values)
	â€¢Show 50/"-"

	new_targets_and_values â†© âˆ¾ StripEmpty <âˆ˜(1âŠ¸âŠ‘ ScaleTargetByValue âŠ‘)Ë˜  new_targets_and_values
	â€¢Show "new3"â€¿(new_targets_and_values)
	â€¢Show 50/"-"


	new_targets_and_values â†© âˆ¾ StripEmpty <âˆ˜(1âŠ¸âŠ‘ ScaleTargetByValue âŠ‘)Ë˜  new_targets_and_values
	â€¢Show "new4"â€¿(new_targets_and_values)
	â€¢Show 50/"-"

	# new_targets_and_values â†© âˆ¾ StripEmpty <âˆ˜(1âŠ¸âŠ‘ ScaleTargetByValue âŠ‘)Ë˜  new_targets_and_values
	# â€¢Show "new5"â€¿(new_targets_and_values)
	# â€¢Show 50/"-"

}

# PartOne data
PartTwo data



# â€¢Show â‰¢âŸ¨"a", "hey there!"âŸ©âˆ¾âŸ¨ "how are ya? Im good"âŸ©
# â€¢Show âˆ¾â¥ŠâŸ¨âŸ¨"a", "hey there!"âŸ©, âŸ¨"pop", "chute"âŸ©âŸ©
# â€¢Show â‰¢âŸ¨"a", "hey there!"âŸ©
# â€¢Show â‰¢âŸ¨ "how are ya? Im good"âŸ©
# â€¢Show â‰¢a

