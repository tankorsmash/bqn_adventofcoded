âŸ¨Get, PostâŸ© â† â€¢Import "../external/bqn-curl/curl.bqn"
âŸ¨FromBytesâŸ© â† â€¢Import "../external/bqn-libs/strings.bqn"
âŸ¨Parse, ExportâŸ© â† â€¢Import "../external/bqn-libs/json.bqn"
âŸ¨ToTimestamp, FromTimestamp âŸ© â† â€¢Import "../external/bqn-libs/datetime.bqn"

Pp â† {â€¢Show 100â†‘â€¢Fmtğ•©â‹„ğ•©}
Rr â† { â€¢Show (100âŠ¸â†‘ â€¢Repr ğ•©)â‹„ğ•©}

Jj â† {â€¢Show (100â†‘ Export ğ•©)â‹„ğ•©}

# use jq to format the json
Jq â† {
	raw_json â† Export ğ•©
	filter â† " | ."
	exitcodeâ€¿stdoutâ€¿stderr â† â€¢SH âŸ¨"jq", "-n", raw_json âˆ¾ filter âŸ©
	â€¢Out 300â†‘ stdout
	ğ•©
}

# finds the data associated to the field
FindColumn â† {
	column_name â† <ğ•¨
	column_name ({((â‰ âŠğ•©)â†‘ğ•¨âŠ¸â·)âˆ˜âŠğ•©}/1âŠ¸âŠ) ğ•©
}

Split â† ((+`âˆ˜=)âŠ”âŠ¢)
SplitRepl â† {
	raw â† ğ•¨((+`âˆ˜=)âŠ”âŠ¢)ğ•©
		(ğ•¨âŠ¸â‰ /âŠ¢)Â¨ raw
}

PMon â† { 1: "Jan"; 2: "Feb"; 3: "Mar"; 4: "Apr"; 5: "May"; 6: "Jun"; 7: "Jul"; 8: "Aug"; 9: "Sep"; 10: "Oct"; 11: "Nov"; 12: "Dec"}
PMonth â† { 1: "January"; 2: "February"; 3: "March"; 4: "April"; 5: "May"; 6: "June"; 7: "July"; 8: "August"; 9: "September"; 10: "October"; 11: "November"; 12: "December"}
TimeToString â† {ğ•Š yearâ€¿monthâ€¿dayâ€¿hourâ€¿minuteâ€¿second:
	Pad â† 2âŠ¸(-âŠ¸â†‘)
	< âˆ¾(â€¢Repr year)âˆ¾" "âˆ¾(<PMon month)âˆ¾" "âˆ¾(â€¢Repr day)âˆ¾", "âˆ¾(â€¢Repr hour)âˆ¾"h"âˆ¾(Pad â€¢Repr minute)âˆ¾"m"âˆ¾(Pad â€¢Repr second)âˆ¾"s"
}

Reorder â† { first_keysğ•Šarr:
	remaining_keys â† / Â¬ first_keysâŠ¸(âˆŠËœ) â†•â‰ arr
	(first_keysâˆ¾remaining_keys)âŠarr
}

sec_json â† Parse â€¢file.Bytes "../data/securities/2023_aapl.json"
results â† ((/(<"results")â·âŠ)âŠ1âŠ¸âŠ)sec_json
Time â† ToTimestamp Ã·âŸœ1000
entries â†  20â†‘ âŠ‘results
entries â†© (6â€¿2â€¿3â€¿4)âŠ¸ReorderË˜Â¨ entries
# â€¢ShowÂ¨ entries
entry â† âŠ‘entries
GetIdx â† {nameğ•Šrow: âŠ‘/((<name)â·âŠ) row}
time_idx â†  "t" GetIdx entry
open_idx â†  "o" GetIdx entry
close_idx â† "c" GetIdx entry
vol_idx â†   "v" GetIdx entry
entries_times â† (TimeToStringâˆ˜âˆ¾)Ë˜â‰> Time (â‹ˆâˆ˜time_idxâŠ¸âŠ 1âŠ¸âŠ)Â¨ entries

â€¢Show "headers"â€¿(headers â† âŠâŠ‘entries)
â€¢Show headers âˆ¾ dataâ† > 1âŠ¸âŠÂ¨ entries

â€¢Show {ğ•Štimeâ€¿open: TimeToString>Time time}Ë˜ time_idxâ€¿open_idxâŠ¸âŠË˜data

# â€¢Show 5âŒ½"01234567"

â€¢Show "done"

